# NekoPages

## Что это?

Это - бот для vk.com / vk.ru, задача которого - качать веб-страницы по ссылке и отправлять их вам.

## Как?

Бот полагается на библиотеку [vk_api](https://github.com/python273/vk_api) (ужасный выбор, там нет многопоточности, знаю, но для одного человека этого достаточно) для работы с API ВКонтакте, на [single-file-cli](https://github.com/gildas-lormeau/single-file-cli) для загрузки страниц (а он, в свою очередь, полагается на Chromium), сжимает их gzip и отправляет вам. Всё, что нужно сделать с клиентской стороны - это распаковать gzip и открыть страницу в браузере.

## Зачем?

В России живём! Когда на мобильном интернете почти ничего не работает, а новости почитать хочется, и не такое придумаешь.

--------

## Установка

Для установки вам понадобятся: `python3`, модуль `venv` для Python (обычно поставляется вместе с python3), `wget`, `chromium` (или любой другой совместимый веб-браузер, он нужен для работы single-file-cli. Проверял с google-chrome на Arch Linux, тоже работает)

Автоматическая:

```bash
git clone https://github.com/gaussandhisgun/nekopages.git
cd nekopages
chmod a+x ./autosetup.sh
./autosetup.sh
```

Ручная:

Откройте autosetup.sh и повторяйте за скриптом.

## Настройка

Настройки бота хранятся в файле bot.ini:

- `searx_instance` - инстанс SearxNG, который бот будет использовать для поиска - в случае, если ваш запрос не похож на URL.
- `group_id` - цифровой ID группы, из которой вы запускаете бота. Его можно узнать в настройках группы - прямо под полем "Адрес" в разделе "Основная информация". Да-да-да, вот это вот publicNNNNNNNNN, только без "public", а чисто цифры.
- `group_token` - [токен группы](https://dev.vk.com/ru/api/access-token/community-token/in-community-settings). Токену нужны следующие разрешения:
	+ управление сообществом - для получения сервера Long Poll API (кстати, не забудьте его включить, на момент написания README актуальная версия 5.199 работает нормально)
	+ сообщения сообщества - для чтения и отправки сообщений в диалоге с вами
	+ документы - для загрузки сжатых веб-страниц
- `my_id` - ваш цифровой ID. Если он присутствует, бот будет отвечать только на сообщения от пользователя с этим цифровым ID. Если его нет, он будет отвечать всем подряд - что, ввиду особенностей используемой API библиотеки, создаст очень большие задержки, поэтому лучше оставьте всё себе любимому. Его можно получить в [настройках аккаунта](https://id.vk.com/account/#/personal) - он удобно размещён на самом видном месте с отдельной кнопкой "Скопировать".

## Использование

Напишите боту поисковый запрос или URL-адрес. Подождите, пока он загрузит страницу в диалог с вами, скачайте её на локальное устройство, распакуйте с помощью `gunzip` и откройте в веб-браузере на ваш выбор.

### Termux

С ботом поставляется скрипт `termux-file-editor` - это "оболочка" для Termux, которая полуавтоматически распаковывает загруженный GZip и открывает его в браузере для удобоваримого чтения.

Для установки этого скрипта:

1. Установите [Termux](https://f-droid.org/ru/packages/com.termux/)
2. Внутри Termux, установите gzip и termux-tools: `apt install -y gzip termux-tools`
3. В файле `~/.termux/termux.properties` раскомментируйте или допишите строчку `allow-external-apps = true` (это позволит Termux делиться файлами с системой)
4. Создайте папку ~/bin и поместите файл `termux-file-editor` в неё.

При открытии загруженного GZip, выберите в качестве приложения для открытия Termux, в поп-апе нажмите Edit и подождите несколько секунд, пока Termux не предложит вам выбрать браузер. Firefox, к сожалению, не поддерживает открытие веб-страниц таким образом, поэтому вам, возможно, понадобится установить LineageOS Jelly или один из его форков - например, [jQuarks](https://f-droid.org/packages/com.oF2pks.jquarks/).

## Ограничения

Загруженные веб-страницы - это статический снимок веб-страницы на момент отправки запроса боту. Если веб-страница требует авторизации, прохождения капчи или какого-либо ввода со стороны пользователя - скорее всего, она работать не будет. Но новости, анекдоты, Хабр или Stack Overflow почитать можно.

Все ссылки продолжают вести туда, куда они бы вели обычно. Но вы можете скопировать ссылку, отправить её боту и загрузить новую веб-страницу.

Веб-страницы загружаются в десктопном Chromium с соответствующим разрешением экрана. Это значит, что некоторые сайты - например, те, которые полагаются на user-agent браузера для реализации адаптивности, могут выглядеть немного странно.